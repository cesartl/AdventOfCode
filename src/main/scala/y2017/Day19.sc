import java.util.regex.Pattern

import scala.annotation.tailrec

val test = "     |          \n     |  +--+    \n     A  |  C    \n F---|----E|--+ \n     |  |  |  D \n     +B-+  +--+ "
val cesar = " |                                                                                                                                                                                                       \n |               +-------------------------------------------------------------+     +-------------------------------------------------+ +---+ +---------------------------------------------+   +-----+ \n |               |                                                             |     |                                                 | |   | |                                             |   |     | \n |               +---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------+ |   |     | \n |                                                                             |     |                                                 | |   | |                                           | |   |     | \n +-----------------------------------------------------------------------------|-----------------------------------------------------------------------------------+                       | |   |     | \n                                                                               |     |                                                 | |   | |                   |                       | |   |     | \n                         +-----------------------------------------------------|-----|---------------------------------------------------|-----+   +---------------|---------------------+ | |   |     | \n                         |                                                     |     |                                                 | |   |     |               |                     | | |   |     | \n     +-------------------------------------------------------------------------------|-------------------------------------------------|-|---------|---------------------------------------------|---+ | \n     |                   |                                                     |     |                                                 | |   |     |               |                     | | |   |   | | \n     |                   |               +---+                         +---+ +-------|-------------------+                             | |   |     |               | +-------------+     | | |   |   | | \n     |                   |               |   |                         |   | | |     |                   |                             | |   |     |               | |             |     | | |   |   | | \n     |                   |               |   +-----------------------------|-|---------------------------|-----------------------------|-|---|-----------------------|-------------|-------|-|---|---+ | \n     |                   |               |                             |   | | |     |                   |                             | |   |     |               | |             |     | | |   |     | \n +-------------+         +---------------------------------------------|-----|-|---------------------------------------------------+ +---+   |     | +-------------|---------------|-----+ | |   |     | \n |   |         |                         |                             |   | | |     |                   |                         | | |     |     | |             | |             |       | |   |     | \n |   |         |                         |           +---------------------+ | |     |         +---------|-------------------------+ | |     |     | |             | |             |       | |   |     | \n |   |         |                         |           |                 |     | |     |         |         |                           | |     |     | |             | |             |       | |   |     | \n |   |         +-------------------------|-----------------------------|-----|-|---------------|-------------------------------+   +-|-|-+   |     | |             | |             |       | |   |     | \n |   |                                   |           |                 |     | |     |         |         |                     |   | | | |   |     | |             | |             |       | |   |     | \n |   |                                 +-|-----------|-----------------|-----|---------------------------------------+         |   | | | |   |     | |             | |             |       | |   |     | \n |   |                                 | |           |                 |     | |     |         |         |           |         |   | | | |   |     | |             | |             |       | |   |     | \n |   |                 +---------+     | |         +-|-----------------|-----|-------|---------|---------------------+         |   | | | |   +-------|---------------|-+     +-----+       | |   |     | \n |   |                 |         |     | |         | |                 |     | |     |         |         |                     |   | | | |         | |             | | |     |             | |   |     | \n |   |                 |         |     | |         | |     +-----------|-----|-----------------|-------+ +---------------------------|-|---------------------------|-|-|---+ |             | |   |     | \n |   |                 |         |     | |         | |     |           |     | |     |         |       |                       |   | | | |         | |             | | |   | |             | |   |     | \n |   |                 |         |     | |         | | +---|-------+   | +---|-------|---------|-------|-----------------------------|---|U------------------------|-------|---------+     | |   |     | \n |   |                 |         |     | |         | | |   |       |   | |   | |     |         |       |                       |   | | | |         | |             | | |   | |       |     | |   |     | \n |   |                 |         |     | |         +---|-----------|---|-------|-----|-----------------|-----------------------------|-|-------------|----O------------|-+ | |       |     | |   |     | \n |   |                 |         |     | |           | |   |       |   | |   | |     |         |       |                       |   | | | |         | |             | | | | | |       |     | |   |     | \n |   |             +---------+   |     | |   +---------|---|-----+ |   | |   | | +-------------|-----------------------------------|-|-|-|-----------|-----+       | | +---+ |       |     | |   |     | \n |   |             |   |     |   |     | |   |       | |   |     | |   | |   | | |   |         |       |                       |   | | | |         | |     |       | |   |   |       |     | |   |     | \n |   |             |   |     |   |     | |   |       | |   |     | |   | +-----|-|---|---------|-------|-----------------------|---------------------|-----|-----------+ |   |       |     | |   |     | \n |   |             |   |     |   |     | |   |       | |   |     | |   |     | | |   |         |       |                       |   | | | |         | |     |       | | | |   |       |     | |   |     | \n |   |             |   |     |   |     | |   |   +---|-|---|-------|-------------|---------------------|-----------------------------|---|-------+ | |     |       | | | |   |     +-|-+   | |   |     | \n |   |             |   |     |   |     | |   |   |   | |   |     | |   |     | | |   |         |       |                       |   | | | |       | | |     |       | | | |   |     | | |   | |   |     | \n |   |             |   |     |   |     | |   |   |   +-|---|-----|-|-------------|---|-----------------|-----------------------|---|-------------|---|-------------------|-----+   | | |   | |   |     | \n |   |             |   |     |   |     | |   |   |     |   |     | |   |     | | |   |         |       |                       |   | | | |       | | |     |       | | | |   | |   | | |   | |   |     | \n |   |             |   |     |   |   +---|-----+ |     |   | +---------|-------------|-----------------|-----------------+     |   | | | |       | | |     |       | | | |   +-----|-------|-|-+ |     | \n |   |             |   |     |   |   | | |   | | |     |   | |   | |   |     | | |   |         |       |                 |     |   | | | |       | | |     |       | | | |     |   | | |   | | | |     | \n |   |             |   |     |   |   | | |   | | +-----|---|-|---------------|---|-------------|-------------------------|-----|---|-|-|---------|-|---------------|-|-|-|---+ |   | | |   | | | |     | \n |   |             |   |     |   |   | | |   | |       |   | |   | |   |     | | |   |         |       |                 |     |   | | | |       | | |     |       | | | |   | |   | | |   | | | |     | \n |   |             |   |     |   |   | | |   | |       |   | | +-|-|---------|---|---|---------|-------|-----------------|-----|---|---|-+ +---+ | | | +---|---------|--R----|-|---|-|-|---|---+ |     | \n |   |             |   |     |   |   | | |   | |       |   | | | | |   |     | | |   |         |       |                 |     |   | | |   |   | | | | |   |       | | | |   | |   | | |   | |   |     | \n |   | +---------------|---------|---|-|---+ | |       +-+ | | | | +---|---+ | | |   +-----------------|-----------------|-------------|---------|-|-------------------|-|-----|---|-|-|---|---+ |     | \n |   | |           |   |     |   |   | | | | | |         | | | | |     |   | | | |             |       |                 |     |   | | |   |   | | | | |   |       | | | |   | |   | | |   | | | |     | \n |   | |           |   |     |   |   | | | | +-+         | | | | |     |   | | | |             |   +---|-----------------|-----+   | +-----|-----|-----|-----------|-|---|-----|-----------|-|-|-|---+ | \n |   | |           |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |                 |         |   |   |   | | | | |   |       | | | |   | |   | | |   | | | |   | | \n |   | +-----------|---------|---|---|-------------------------|-------|---|-|-|---------------|-------|-----------------|-----+   |   +-+ |   | | | | |   |       | | | |   | |   | | |   | | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |                 |     |   |     | |   | | | | |   |       | | | |   | |   | | |   | | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |         +-----------------|-------|---|-|-----|-----------|-|-|-----+ |   | | +---+ | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           +-|---|-----|-------|-|---+             | | | | |     |   | | +-+             |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   | |                 |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   | |                 |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   | |                 |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   | +---------------+ |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     | +-----------|-+ |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   |                 | |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     | | | |       |   |   | | \n | +-------------+ |   |   +-|---|---|---|---------------------|-|-----|-----------------------+   |   |         |       |     |   |     | |   | | | | |   |       | | | |     | +-|-+       |   |   | | \n | | |             |   |   | |   |   | | |               | | | | |     |   |                 |     |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   |         |   |   | | \n | | |             |   |   | |   |   | | |               | | | | |     |   |                 |     |   |         |     +-|---------|-----|-|-+ +-|-|-------|---+   | | | |     |   |         |   |   | | \n | | |             |   |   | |   |   | | |               | | | | |     |   |                 |     |   |         |     | |     |   |     | | |   | | | |   |   |   | | | |     |   |         |   |   | | \n | | |             |   |   | |   +-----------------------|-|-|-|-|-----------------------------------------------|-----+ |     |   |     | | |   | | | |   |   |   | | | |     |   |         |   |   | | \n | | |             |   |   | |       | | |               | | | | |     |   |                 |     |   |         |       |     |   |     | | |   | | | |   |   |   | | | |     |   |         |   |   | | \n | | |             |   |   | |       | | |               | | | | |     |   |   +---------------+   |   |         |       |     |   |     | | |   | | | |   |   |   | | | |   +-----|---------|---+   | | \n | | |             |   |   | |       | | |               | | | | |     |   |   |             | |   |   |         |       |     |   |     | | |   | | | |   |   |   | | | |   | |   |         |       | | \n | | |             |   |   | |       | | |       +---------|-|-|-------|---|-----------------|---+ |   |         |       +-----|-------------|---|-|-|-|---|-------|-----------|-------------------+ | | \n | | |             |   |   | |       | | |       |       | | | | |     |   |   |             | | | |   |         |             |   |     | | |   | | | |   |   |   | | | |   | |   |         |     | | | \n | | |             |   | +-|-|-----------|---------------|---|-|-|---------|-----------------|---------------------------------|---|-----------+ | | | |   |   |   | | | |   | |   |         |     | | | \n | | |             |   | | | |       | | |       |       | | | | |     |   |   |             | | | |   |         |             |   |     | | | | | | | |   |   |   | | | |   | |   |         |     | | | \n | +---+           |   | | | |       | | |       |       | | | | |     |   |   |             | | | |   |         |             |   |     | | | | | | | |   |   +-+ | | | |   | |   |         |     | | | \n |   | |           |   | | | |       | | |       |       | | | | |     |   |   |             | | | |   |         |             |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | | +-------|-|-|-------|-------|---|---|-----|---|---+           +---|-----------------+             |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       |       | | | | |     |   |               | | | | |   |                       |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       |       | | | | |     |   |               | | | | |   |                       |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       |       | | | | |     |   |               | | | | |   |                       |   |     | | Z | | C | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       | +---+ | | | | |     |   |               | | | | |   |                       |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       | |   | | | | | |     |   |               | | | | |   |                       |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | | +-----|---------|-|-|-------------------------+ | | | | |   |                       |   |     | | | | | | | +-------+ | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                       |   |     | | | | | | |     |   | | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                       |   |     | | | | +---|---+ | F +-----|---|---------|---------------|-+ | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                       |   |     | | | |   | |   | | |   | | | | |   | |   |         |     |   | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                       +-------+ | | | |   | |   | | |   | | | | |   | |   |         |     |   | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                           |   | | | | |   | |   | | |   | | | | |   | |   |         |     |   | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | +---|-|-|---|-----------+               |   +-------|---|-|-------|-+ | | | | |   | |   |         | +---|-+ | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             |   | | | |   |           |               |     | | | |   | |   | | | | | | | | |   | |   |         | |   | | | \n |   | |           | +---|-----------------------|-----|-|-----|-------|---------------------------|---------------|---------------------------------|---|-|-|---|-------+   | |   |         | |   | | | \n |   | |           | | | | |         | | | |     | |   | | | | | |     |   |             |   | | | |   |           |               |     | | | |   | |   | | | | | | | |     | |   |         | |   | | | \n |   | |           | | | | |         | | | |     | |   +---|-|---------------------------|---|---------------------|-----+         +-------|-|-|-----|---|-|-|-------|-+ +---|-----------+   | |   | | | \n |   | |           | | | | |         | | | |     | |     | | | | |     |   |             |   | | | |   |           |     |               | | | |   | |   | | | | | | |   |   | |   |     |   | |   | | | \n |   | |       +---|---|---|-----------+ | |     | |     | | | | |     |   |             |   | | | |   +-----------|-----|-----------------|-|-|---|-|---------|---|---+ |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |     | |     | | | | |     |   |             |   | | | |               |     |               | | | |   | |   | | | | | | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |     +---------------|---------+             |   | | | |       +-------|---------------------|---|-------------+ +-|-+ | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |           +-+   |   +---|-------+ |       |     +-------------+ | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | +-|-------------|---------|---------|-|-------|-----------|-|---------|-|-|-------|-----------------------------|---+ |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | |   |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | |   |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | |   |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | |   |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | |   |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | |   |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | |   |       +-|---|-|-------|-------|-|-|-------------------|-|-+ |     | | |     | |       |                   | | |   |   | |   |     +-----|---+ +-|---------------|---+ | | | \n |   | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     | |       |                   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n |   | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     | |       |                   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n |   | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     | |       |                   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | +---|-----------|-|-|-----------|-|---|-------------------|---------|--E--------|---------------|-----|-+       |       +-------+   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | | | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | | | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | | | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | | | +-------|---|---+   |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |         +---------|-|---+     |   | | | | | | \n | | |         |   | |     |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |           | |   | | |         |   | | | | | | \n | | |         |   | | +---|-------------|-|-------|-------------|-------------------+ | |     | | |     |         |       |       |   | | |   |   | |   |           | |   | | |         |   | | | | | | \n | | |         |   | | |   |       | |   | |       |     | | | | |     |           |   | |     | | |     |         |       |       |   | | |   |   | |   |           | |   | | |         |   | | | | | | \n | | |         |   | | |   |       | |   | |       |     | | | | |     |           |   | |     | | |     |         |       |       +---+ | |   |   | |   |         +-|-+   | | |         |   | | | | | | \n | | |         |   | | |   |       | |   | |       |     | | | | |     |           |   | |     | | |     |         |       |             | |   |   | |   |         | |     | | |         |   | | | | | | \n | | |         |   | | |   +---------|---|---------------|-|-|-|-|-----|---+     +-|-----------|-|-|-----------------------|-------------------|-------------------|-|-------|---+       |   | | | | | | \n | | |         |   | | |           | |   | |       |     | | | | |     |   |     | |   | |     | | |     |         |       |             | |   |   | |   |         | |     | | | |       |   | | | | | | \n | | |         |   | | |           +-|-------------|-------|---|-------|---------------|-|-----------+   |         |       |             | |   |   | |   |         | |     | | | |       |   | | | | | | \n | | |         |   | | |             |   | |       |     | | | | |     |   |     | |   | |     | | | |   |         |       |             | |   |   | |   |         | |     | | | |       |   | | | | | | \n | | |     +-------|-|-|-------------------|-------|-------|---|-----------|-------------+     | +-|-|---|-----------------|-------------------|---------|-------------------|---|-----------|---|-----+ \n | | |     |   |   | | |             |   | |       |     | | | | |     |   |     | |   |       |   | |   |         |       |             | |   |   | |   |         | |     | | | |       |   | | | | |   \n | | |     |   |   | | | +-------------+ | |       | +---------------------|-----|-|-----------|---|-|-------------|-------|-----------+ | |   |   | |   |         | |     | | | |       | +-----|-+ |   \n | | |     |   |   | | | |           | | | |       | |   | | | | |     |   |     | |   |       |   | |   |         |       |           | | |   |   | |   |         | |     | | | |       | | | | |   |   \n | | |     |   |   | | | |   +-------------|---------+   | | | | | +---|---------|-----|-------|---|-|---------------------|-----------+ | |   |   | |   |         | |     | | | |       | | | | |   |   \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |     | |   |       |   | |   |         |       |             | |   |   | |   |         | |     | | | |       | | | | |   |   \n | | |     |   |   | | +-----|---------|-|-|-------------|---|-|-|-|-------------+ |   |       |   | |   |         |       |             | |   |   | |   |         | |     | | | |       | | | | | +---+ \n | | |     |   |   | |   |   |       | | | |       |     | | | | | |   |   |       |   |       |   | |   |         |       |             | |   |   | |   |         | |     | | | |       | | | | | | | | \n | | |     |   |   | | +-------------|-|-----------------|---|---|-|---|---|-------|---|-----------+ | +-|---------|--------------M------|---------------------+ +-+ |     | | | |       | | | | | | | | \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |     | | |         |       |             | |   |   | |   |     | |   |     | | | |       | | | | | | | | \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |   +---|---+       |       |             | |   | +-|-----------|-|---|-----|-+ | |   +---|---|---|-|-|-+ \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | |   |     | |   |     |   | |   |   | | | | | | |   \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | +-|-----|-----------|---|-----|---|-|-|---|-|-|-+ \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | +-----|-|---|---+   | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | | | | | |   |   |   | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | | | | | +---|-------|-|-+ |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | | | | |     |   |   | |   |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | | | | |     |   +---|-|---|-------|-------|-------+   +-----------|---|-------------|-|-|-|-------|-------+             | | +---|---|---|-----|-----------------+   |   | | | | | | | | \n | | |     |   | | | | |     |       | |   |       |     | | | | |         |       |   |       |   | | | | |       |                     | | | | | | | | |     | |   |     |   |     |   | | | | | | | | \n | | |     |   | | | | +---------------------------+     | | | | |         |       |   |       |   | | | | |       |       +-------------+ +-+ | | | | | |     | |   |     |   |     |   | | | | +-+ | | \n | | |     |   | | | |       |       | |   |             | | | | |         |       |   |       |   | | | | |       |       |                   | | | | | |     | |   |     |   |     |   | | | |     | | \n | | +-----|-+ | | | |       |       | |   | +-----------|-------|---------|---+   |   |       |   | | | | |       |       |           +---+ +-------|-|-+     | |   |     |   |     |   | | | |     | | \n | |       | | | | | |       |       | |   | |           | | | | |         |   |   |   |       |   | | | | |       |       |           |   | | | | | | |       | |   |     |   |     |   | | | |     | | \n | |       | | | | | |       |       | |   | |           | | | | |         |   |   |   |       |   | | | | |       |       |           |   | | | | | +-|---------|---|---------------------|-------+ | | \n | |       | | | | | |       |       | |   | |           | | | | |         |   |   |   |       |   | | | | |       |       |           |   | | | | |   |       | |   |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |   +-------|-------------|-------------|-----------------------|-----|-|-----------|-|-+ |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |       |           |   | | | | |   |       | | | |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |       +-+         |   | | | | |   |       | | | |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |         |         |   | | | | |   |       | | | |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |         |         | +-|-|-|-|-------------|-|-|-+     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |         |         | | | | | | |   |       | | |       |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   +-------|-----|-----|-----------------|---------|---|-+ | | |   |       | | |       |   |     |   +-+ | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |           |   | | | | |       |         |         | | |   | | |   |       | | |       |   |     |       | |   | | | \n | | +---------|-----------+ |       | |   | |         +-----|-----------------+   +-----------|---------|-+       |       +-|-------+ | | +---+ | |   | +-+   | +-|---------------+ |       | |   | | | \n | | |     | | | | | |     | |       | |   | |         | | | | | |         |   |               |   | | | |         |       | |       | | |       | |   | | |   |   |       |   |   | |       | |   | | | \n | | |     | | | | | |     | |       | |   | |         | | | | | |         |   |               |   | | | |         |       | |       +-|-|-------+ |   | | |   |   |       |   |   | |       | |   | | | \n | | |     | | | | | |     | |       | |   | |         | | | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   |   |       |   |   | |       | |   | | | \n | | |     | | | | | +-------|-------------|-|---------|---|---|-|-----------------------------|-------|-|-----------------------------|-|-------------|-|-|-------|-----------------|-------|-|---|-+ | \n | | |     | | | | |       | |       | |   | |         | | | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   |   |       |   |   | |       | |   |   | \n | | |     | | | | |       | |       | |   | |         | +-|---|-|---------|-----------------------------------------------|-|-----------|---------|---|-|-------+ |       |   |   | |       | | +---+ | \n | | |     | | | | |       | |       | |   | |         |   | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   | | |       |   |   | |       | | | | | | \n | | |     | | | | |       | |       | |   | |         |   | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   | | |       |   |   | |       | | | | | | \n | | |     | | | | |       | |       | |   | |         |   | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   | | |       |   |   | |       | | | | | | \n | | +-------|-----+       | |       | |   | |         |   | | | |         +---|---------------|-------|-|---------|-------------------------------|---+ | |   | | |       |   |   | |       | | | | | | \n | |       | | | |         | |       | |   | |         |   | | | |             |               |   | | | |         |       | |         | |         |     | |   | | |       |   |   | |       | | | | | | \n +-|---------|-----------------------------|-|-------------|---|---------------|-------------------|---|-|-----------------------------+ |         |   +-|-----|---|-------|-----+ | |       | | | | | | \n   |       | | | |         | |       | |   | |         |   | | | |             |               |   | | | |         |       | |           |         |   | | |   | | |       |   | | | |       | | | | | | \n   |       | | | |         | |       | +-------------------|---|-|-----------------------------|---|---|-|---------|-----------------------------------+ | |   | | |       |   | | | |       | | | | | | \n   |       | | | |         | |       |     | |         |   | | | |             |               |   | | | |         |       | |           |         |     | |   | | |       |   | | | |       | | | | | | \n   |       | | | |         | |       |     | |         |   | | | |             |               |   | | | | +---------------|-|-----------+         |     | |   +---|-----------|---|-------------+ | | | \n   |       | | | |         | |       |     | |         |   | | | |             |               |   | | | | |       |       | |                     |     | |     | |       |   | | | |       | |   | | | \n   |       | | | |         +-|-------|-----|-----------+   | | | |             |               |   | | +-|-|-------|---------|---------+           +-------|-------|---------+ | | | |       | |   | | | \n   |       | | | |           |       |     | |             | | | |             |               |   | |   | |       |       | |         |                 | |     | |       | | | | | |       | |   | | | \n   |       | | | |           |   +---|-----+ |             | | | |             |     +---------+   +-|---+ +---------------|-|---------|-----------------|-+     | |       | | | | | |       | |   | | | \n   |       | | | |           |   |   |       |             | | | |             |     |               |             |       | |         |                 |       | |       | | | | | |       | |   | | | \n   |       | | | |           |   |   |       |             | | | |             |     +-----------------------------+       +-+     +-----------------------------+ |       | | | | | | +-+   +-+   | | | \n   |       | | | |           |   |   |       |             | | | |             |                     |                             |   |                 |         |       | | | | | | | |         | | | \n   |       | | | |           |   +-----------|-------------|---+ |             |                     +---------------------------------+                 |         |       | +-+ | | | | +---+ +---+ | | \n   |       | | | |           |       |       |             | |   |             |                                                   |                     |         |       |     | | | |     | |     | | \n   |       | | | |           |       |       |             | |   +-------------|---------------------------------------------------------+               | +-------+       | +---|-|-|-|-+   +-+   +-+ | \n   |       | | | |           |       |       |             | |                 |                                                   |     |               | |               | |   | | | | |         |   | \n   |       | | | |           |       |       |             | |                 +---------------------------------------------------------|---------------------------------|-+   | | +-|-+         |   | \n   |       | | | |           |       |       |             | |                                                                     |     |               | |               |     | |   |           |   | \n   |   +-------|-+           +---------------|-------------+ |                                   +---------------------------------|-----|---------------------------------------+ |   |           |   | \n   |   |   | | |                     |       |               |                                   |                                 |     |               | |               |       |   |           |   | \n   | +-+   | +-+                     |       |               | +---------------------------------|---------------------------------------+               | |               +--Q--+ +-+ |           |   | \n   | |     |                         |       |               | |                                 |                                 |                     | |                     |   | |           |   | \n   | +-----+                         |       +---------------|-+         +-----------------------+                                 +---------------------+ +---------------------+   +-|-----------+   | \n   |                                 |                       |           |                                                                                                             |               | \n   |                                 +-----------------------+           +-------------------------------------------------------------------------------------------------------------+               | \n   |                                                                                                                                                                                                   | \n   +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ \n                                                                                                                                                                                                         "

def parse(s: String) = s.split("\n").toList.map(row => row.split("").toList)

parse(test)

sealed trait Direction {
  def move(position: (Int, Int)): (Int, Int)
}

case class Up() extends Direction {
  override def move(position: (Int, Int)) = (position._1 - 1, position._2)
}

case class Down() extends Direction {
  override def move(position: (Int, Int)) = (position._1 + 1, position._2)
}

case class Left() extends Direction {
  override def move(position: (Int, Int)) = (position._1, position._2 - 1)
}

case class Right() extends Direction {
  override def move(position: (Int, Int)) = (position._1, position._2 + 1)
}

val letterPattern = Pattern.compile("[A-Z]")

case class State(position: (Int, Int), direction: Direction, visited: Seq[String], finished: Boolean, grid: Seq[Seq[String]]) {

  def chartAt(p: (Int, Int)): Option[String] = {
    if (p._1 < grid.length) {
      val row = grid(p._1)
      if (p._2 < row.length) {
        return Some(row(p._2))
      }
    }
    None
  }

  def move(): State = {
    val nextPosition = direction.move(position)
    val nextChar: Option[String] = chartAt(nextPosition)
    if (nextChar.isEmpty) {
      State(nextPosition, direction, visited, finished = true, grid)
    } else if (letterPattern.matcher(nextChar.get).matches()) {
      State(nextPosition, direction, nextChar.get +: visited, finished = false, grid)
    } else if (nextChar.get.equals("-") || nextChar.get.equals("|")) {
      State(nextPosition, direction, visited, finished = false, grid)
    } else if (nextChar.get.equals("+")) {
      val newDirection = direction match {
        case Down() | Up() => if (chartAt(Right().move(nextPosition)).exists(c => !c.equals(" "))) Right() else Left()
        case Right() | Left() => if (chartAt(Up().move(nextPosition)).exists(c => !c.equals(" "))) Up() else Down()
      }
      State(nextPosition, newDirection, visited, finished = false, grid)
    } else {
      State(nextPosition, direction, visited, finished = true, grid)
    }
  }
}

@tailrec
def solve(state: State, count: Int): (State, Int) = if (state.finished) (state, count) else solve(state.move(), count + 1)

val testState = State((0, 5), Down(), List(), false, parse(test))

testState.grid(1)(5)

solve(testState, 0)._2


val cesarState = State((0, 1), Down(), List(), finished = false, parse(cesar))


solve(cesarState, 0)._2





